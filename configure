#!/bin/sh

prefix=/usr/local
version=0.0

while : ; do
  case "$1" in
    "") break;;

    --prefix)
	prefix=$2; shift;;
    --prefix=*)
	prefix=`expr "$1" : '--[^=]*=\(.*\)'`;;
  esac
  shift
done

cat > config <<ENDOFFILE
# # # THIS FILE IS GENERATED AUTOMATICALLY BY CONFIGURE # # #

LIBDIR := ${prefix}/lib/websocketml

OCAMLC    := ocamlc
OCAMLOPT  := ocamlopt
OCAMLRUN  := ocamlrun
OCAMLDEP  := ocamldep
OCAMLFIND := ocamlfind

OCAMLFLAGS ?= -annot

%.cmi : %.mli
	\$(OCAMLC) -c -o $@ \$(OCAMLFLAGS) \$(INCLUDES) $<
%.cmo %.cmi: %.ml
	\$(OCAMLC) -c -o $@ \$(OCAMLFLAGS) \$(INCLUDES) $<
%.cmx %.cmi: %.ml
	\$(OCAMLOPT) -c -o $@ \$(OCAMLFLAGS) \$(INCLUDES) $<
ENDOFFILE

cat > META <<ENDOFFILE
directory = "${prefix}/lib/websocketml"
version = "${version}"
description = "A simple websocket library for OCaml with no dependency"
archive(byte) = "websocketml.cma"
archive(native) = "websocketml.cmxa"
ENDOFFILE

cat > opam <<ENDOFFILE
opam-version: "2.0"
name: "websocketml"
version: "${version}"
synopsis: "A simple websocket library for OCaml with no dependency"
maintainer: "ismailbennani <ismail.lahkim.bennani@ens.fr>"
authors: "ismailbennani <ismail.lahkim.bennani@ens.fr>"
license: "GPL-3.0"
homepage: "https://github.com/ismailbennani/websocketml"
bug-reports: "https://github.com/ismailbennani/websocketml/issues"
build: [
  ["./configure" "--prefix=%{prefix}%"]
  [make]
]
install: [make "install"]
dev-repo: "git+https://github.com/ismailbennani/websocketml"
ENDOFFILE
